- name: List of the ssl .conf files and store it in register
  raw: find /etc/nginx/conf.d -type f -name "*.conf"
  register: ssl_conf_dir_files

- name: Update conf files port 80 ipv6
  lineinfile:
    path: "{{ item }}"
    insertafter: 'listen 80'
    line: '  listen [::]:80;'
  with_items: "{{ ssl_conf_dir_files.stdout_lines }}"

- name: Update conf files port 443 ipv6
  lineinfile:
    path: "{{ item }}"
    insertafter: 'listen 443'
    line: '  listen [::]:443;'
  with_items: "{{ ssl_conf_dir_files.stdout_lines }}"
