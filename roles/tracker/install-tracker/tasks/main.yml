- name: Force all notified handlers to run at this point
  meta: flush_handlers

- name: Install tracker application
  include_tasks: "install-tracker-app.yml"
  when: running_mode == 'rescue'
        or applied_tracker_version != tracker_version
        or tracker_skip_cache != ""
        or skip_cache != ""

- name: Setup keitaro database
  when: running_mode == "install"
  block:
  - name: Get lockfile status
    stat:
      path: "{{ keitaro_app_dir }}/var/install.lock"
    register: lockfile

  - name: Execute appropriate tasks
    when: not lockfile.stat.exists
    include_tasks: "setup-database.yml"
    vars:
      ansible_python_interpreter: "/usr/bin/python3"
