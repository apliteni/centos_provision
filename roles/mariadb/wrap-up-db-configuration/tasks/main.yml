- name: Wait for MariaDB service to be ready
  wait_for:
    port: "{{ db_port }}"
    host: "{{ db_host }}"
    connect_timeout: 3
    delay: 3
    timeout: 30

- name: Check tracker database exists
  command: "{{ kctl_path }} run mysql-query 'select 1'"
  failed_when: false
  changed_when: false
  register: check_if_tracker_database_exists_command

- include: create-user-and-database.yml
  vars:
    ansible_python_interpreter: "/usr/bin/python3"
    when: check_if_tracker_database_exists_command.rc == 1    # mysql exits with rc = 1 when there is no specified db
