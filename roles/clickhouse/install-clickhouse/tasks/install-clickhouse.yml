- name: add Clickhouse repository
  template:
    src: Altinity-ClickHouse.repo
    dest: /etc/yum.repos.d
    mode: '0644'

- name: Install by YUM | Install Clickhouse
  yum:
    name: "{{ clickhouse_package }}"
    state: present
    enablerepo: altinity_clickhouse

- name: Replace users config
  template:
    src: users.j2
    dest: "{{ clickhouse_config_path }}/users.xml"
    mode: '0644'
  notify: restart clickhouse

- name: Start service clickhouse-server if not started
  service:
    name: clickhouse-server
    state: started
