- name: set mariadb version to variable
  shell: mysql --version
  register: mysql_version_output
- set_fact:
    tokudb_version: "{{ mysql_version_output.stdout | regex_search('(?<=Distrib )(.*)(?=-MariaDB)') }}"

#get version before last dot (tokudb version 10.x.xx this task capture only 10.x)
- set_fact:
    tokudb_short_version: "{{ tokudb_version | regex_search('.*(?=\\.)') }}"

- name: Install TokuDB Engine
  package:
    name: MariaDB-tokudb-engine
    state: installed
    enablerepo: mariadb
  when: rhel_version == 7

- name: Install jemalloc rpm for Centos 8
  yum:
    name: "{{ jemalloc_rpm }}"
    state: installed
  when: rhel_version == 8

- name: Install jemalloc package for Centos 8
  yum:
    name: jemalloc
    state: installed
  when: rhel_version == 8

- name: Install TokuDB Engine Centos 8
  yum:
    name: "{{ tokudb_engine }}"
    state: installed
  when: rhel_version == 8

- name: Restart MariaDB service
  service:
    name: mariadb
    state: restarted
