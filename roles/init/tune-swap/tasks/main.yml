- name: Disable swap
  shell: "grep -q '^{{ swap_location }} ' /proc/swaps && swapoff {{ swap_location }} || true"

- name: Remove swap
  file:
    path: "{{ swap_location }}"
    state: absent
  register: swap_removed
  ignore_errors: yes

- name: Create swap
  include: create_swap.yml
  when: swap_removed.failed == false
