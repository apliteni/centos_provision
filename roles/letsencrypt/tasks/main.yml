---

- name: Install packages
  package:
    name: certbot
    state: installed

- name: Detect existence of Diffie-Hellman group
  stat:
    path: "/etc/ssl/certs/dhparam.pem"
  register: dhparam

- name: Generate strong Diffie-Hellman group
  command: "openssl dhparam  -out /etc/ssl/certs/dhparam.pem 2048"
  when: not dhparam.stat.exists

- name: Add SSL support to host
  include: add_host.yml domain={{item}}
  with_items: "{{ letsencrypt_cert_domains }}"
