- name: Add MariaDB repo
  template:
    src: mariadb.repo.j2
    dest: /etc/yum.repos.d/mariadb.repo
    force: yes

- name: Install supporting libraries
  package:
    name:
      - jemalloc
      - perl-DBI
      - libaio
      - lsof
      - rsync
      - boost-program-options
    state: installed

- name: Install MariaDB packages
  package:
    name:
      - MariaDB-server
      - MariaDB-client
      - MariaDB-tokudb-engine
    state: installed
    enablerepo: '{{ mariadb_enabled_repos["centos" + ansible_distribution_major_version] }}'
    disablerepo: '*'

- name: Install PyMySQL
  pip:
    name: pymysql
    state: present
    executable: pip3

- name: Ensure mariadb service is started
  service:
    name: mariadb
    state: started
    enabled: yes
