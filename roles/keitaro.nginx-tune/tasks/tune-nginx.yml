- name: Generate nginx configs
  template:
    src: "{{ item }}.j2"
    dest: "/etc/{{ item }}"
  with_items:
    - nginx/nginx.conf
    - nginx/conf.d/keitaro.conf
    - nginx/conf.d/keitaro-tracker.inc
    - nginx/conf.d/keitaro-tracker.php-fpm.inc
    - nginx/conf.d/keitaro-tracker.roadrunner.inc

- name: Remove obsolete files
  file:
    path: "/etc/nginx/conf.d/{{ item }}"
    state: absent
  with_items:
    - keitaro.php-fpm.inc
    - keitaro.roadrunner.inc
    - keitaro.root_location.inc

- name: Reload nginx
  service:
    name: nginx
    state: reloaded
