- name: set mariadb version to variable
  shell: mysql --version
  register: mysql_version_output
- set_fact:
    mariadb_version_output: "{{ mysql_version_output.stdout | regex_search('(?<=Distrib )(.*)(?=-MariaDB)') }}"

- name: remove old mariadb repo
  file:
    path: /etc/yum.repos.d/mariadb.repo
    state: absent

- name: remove old maria Centos 7
  package:
    name: "{{ item }}"
    state: absent
  with_items: "{{ mariadb_packages }}"
  tags: mariadb
  when: mariadb_version_output is not search( '{{ mariadb_version }}' )

- name: remove old galera
  package:
    name: galera
    state: absent
  tags: mariadb
  when: mariadb_version_output is not search( '{{ mariadb_version }}' )

- name: remove old maria Centos 8
  dnf:
    name: [MariaDB-server, MariaDB-client]
    state: absent
  tags: mariadb
  when: rhel_version == 8 and mariadb_version_output is not search( '{{ mariadb_version }}' )
