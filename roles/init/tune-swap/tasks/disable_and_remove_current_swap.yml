- name: Check if swap is enabled
  shell: 'swapon --show | grep {{ swap_file_path }}'
  register: swap_enabled
  changed_when: false
  failed_when: false

- name: Disable swap
  command: 'swapoff {{ swap_file_path }}'
  register: swap_disabled
  when: >
    swap_enabled.rc is defined
      and swap_enabled.rc == 0
  changed_when: false
  failed_when: false

- name: Remove the swap file
  file:
    path: '{{ swap_file_path }}'
    state: absent
  register: swap_removed
  when: >
    (
      swap_disabled.rc is defined
          and swap_disabled.rc == 0
    )
    or (
      swap_enabled.rc is defined
          and swap_enabled.rc != 0
    )

