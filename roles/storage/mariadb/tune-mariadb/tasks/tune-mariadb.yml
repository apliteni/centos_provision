- name: Make stat for path
  stat:
    path: /var/log/mariadb
  register: mariadb_log_dir_stat

- name: Clear symlink if exist
  file:
    state: absent
    path: /var/log/mariadb
  when: mariadb_log_dir_stat.stat.islnk is defined and mariadb_log_dir_stat.stat.islnk

- name: Create log directory
  file:
    path: /var/log/mysql
    owner: mysql
    group: mysql
    state: directory

- name: Create symlinks
  file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: mysql
    group: mysql
    state: link
    force: true
  with_items:
    - src: mysql
      dest: /var/log/mariadb
    - src: mysql
      dest: /var/lib/mariadb

- name: Generate config files
  template:
    src: "my.cnf.d/{{ item }}.j2"
    dest: "/etc/my.cnf.d/{{ item }}"
  with_items:
    - keitaro-mysqld-optimize_performance.cnf
    - keitaro-mysqld-set_default_storage_engine.cnf
    - keitaro-mysqld-configure_error_log.cnf
    - keitaro-mysqld-configure_network.cnf
  notify: 
    - restart mariadb

