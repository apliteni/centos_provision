- name: Uninstall packages
  package:
    name: certbot
    state: absent
  when: rhel_version == 7

- name: Uninstall packages
  dnf:
    name: certbot
    state: absent
  when: rhel_version == 8

- name: Download sertbot-auto
  become: true
  become_user: root
  get_url:
    url: https://dl.eff.org/certbot-auto
    dest: /usr/local/bin/

- name: Execute the certbot-auto
  become: true
  become_user: root
  shell:
    mv certbot-auto /usr/local/bin/certbot-auto
    chown root /usr/local/bin/certbot-auto
    chmod 0755 /usr/local/bin/certbot-auto
    yes | /usr/local/bin/certbot-auto --install-only

- name: Create directory for ssl certs
  file:
    path: "{{ ssl_root }}"
    state: directory

- name: Remove old renewal certs job
  cron:
    name: Renew Let's Encrypt certs
    state: absent
    user: "{{ nginx_user }}"
