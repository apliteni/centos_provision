- name: Create kctl log dir
  file:
    path: /var/log/keitaro
    state: directory

- include_role:
    name: _init/create-user-and-dirs

- set_fact:
    files_to_be_deleted:
      - /etc/nginx/conf.d/keitaro/locations-common.inc
      - /etc/nginx/conf.d/keitaro/locations-tracker.inc

- name: Create necessary directories
  file:
    path: "{{ item | dirname }}"
    state: directory
  with_items: "{{ files_to_be_deleted }}"

- name: Create old files
  file:
    path: "{{ item }}"
    state: touch
  with_items: "{{ files_to_be_deleted }}"

- name: Create old site config
  copy:
    dest: /etc/nginx/conf.d/some.site.conf
    content: |
      root /var/www/keitaro;
      include /etc/nginx/conf.d/keitaro/locations-common.inc;
      include /etc/nginx/conf.d/keitaro/locations-tracker.inc;
