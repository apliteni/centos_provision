- name: Install PyMySQL
  pip:
    name: pymysql
    state: present
    executable: pip3

- name: Get mariadb user info
  ansible.builtin.getent:
    database: passwd
    key: "{{ mariadb_user }}"
    fail_key: false

- name: Fix mysql directories & files permissions
  include_tasks: fix-directory-permissions.yml
  when: getent_passwd[mariadb_user]
  with_items:
    - path: "{{ mariadb_path_to_user_configs }}"
      owner: root
      group: "{{ mariadb_group }}"
    - path: "{{ mariadb_path_to_libs }}"
      owner: "{{ mariadb_user }}"
      group: "{{ mariadb_group }}"
    - path: "{{ mariadb_path_to_logs }}"
      owner: "{{ mariadb_user }}"
      group: "{{ mariadb_group }}"
