---
- name: Update kernel params
  sysctl:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    state: present
  ignore_errors: true
  with_dict: "{{ kernel_sysctl_tweaks }}"

- name: Add service for disabling Transparent Huge Pages
  copy:
    src: files/disable-transparent-hugepages
    dest: /etc/init.d/disable-transparent-hugepages
    mode: 0755

#- name: Enable service for disabling THP
#  command: chkconfig --add disable-transparent-hugepages
#
- name: Disable THP
  systemd:
    name: disable-transparent-hugepages
    state: restarted
    enabled: yes