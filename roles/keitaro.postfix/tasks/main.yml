- name: Ensure postfix is installed.
  package:
    name: [mailx, postfix]
    state: present

- name: Update Postfix configuration.
  lineinfile:
    dest: /etc/postfix/main.cf
    line: "{{ item.name }} = {{ item.value }}"
    regexp: "^{{ item.name }} ="
  with_items:
    - name: inet_interfaces
      value: localhost
    - name: inet_protocols
      value: ipv4
  notify: restart postfix

- set_fact:
    hostname_check: "{{ ansible_hostname | regex_search('^[0-9]+$') }}"

- name: Change hostname if contain only digits
  shell: "hostname {{ ansible_hostname }}a"
  when: hostname_check != ''

- name: Ensure postfix is started and enabled at boot.
  service:
    name: postfix
    state: started
    enabled: true

