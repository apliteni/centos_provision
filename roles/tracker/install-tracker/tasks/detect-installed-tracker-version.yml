- name: Check if version.php exists
  stat:
    path: "{{ keitaro_app_dir }}/version.php"
  register: tracker_app_version_php

- name: Set installed_tracker_version
  when: tracker_app_version_php.stat.exists
  block:

    - name: Get tracker's verion.php content
      slurp:
        src: "{{ keitaro_app_dir }}/version.php"
      register: tracker_app_version_php_content_encoded

    - name: Set installed_tracker_version variable
      set_fact:
        installed_tracker_version: "{{ tracker_app_version_php_content_encoded.content | b64decode | regex_search('[0-9]+(.[0-9]+)+') }}"

    - name: Redefine installed_tracker_version if tracker version < 10
      set_fact:
        installed_tracker_version: "10.0.0"
      when: installed_tracker_version is version('10', '<')
