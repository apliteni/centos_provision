clickhouse_memory_usage_ratio: "{{ olap_db_memory_usage_to_ram_ratio if olap_db == 'clickhouse' else alternative_olap_db_memory_usage_to_ram_ratio }}"
clickhouse_min_memory_mb: 1500 # It does't work if have less RAM
clickhouse_memory_mb: "{{ [(((clickhouse_memory_usage_ratio|float) * ansible_memtotal_mb) | int), clickhouse_min_memory_mb] | max }}"
clickhouse_memory: "{{ (clickhouse_memory_mb | int)  * 1024 * 1024 }}"
clickhouse_memory_mb_per_query: 20
clickhouse_max_concurrent_queries: "{{ ((clickhouse_memory_mb|int) / clickhouse_memory_mb_per_query) | int_between(50, 8192) }}"
clickhouse_memory_mb_per_connection: 20
clickhouse_max_connections:  "{{ ((clickhouse_memory_mb|int) / clickhouse_memory_mb_per_connection) | int_between(50, 8192) }}"

