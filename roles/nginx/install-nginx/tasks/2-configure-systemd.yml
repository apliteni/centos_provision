- name: Make systemd nginx extra config dir
  file:
    path: /etc/systemd/system/nginx.service.d
    state: directory
    mode: '0755'

- name: Generate systemd nginx config
  template:
    src: systemd/keitaro-systemd-nginx.conf.j2
    dest: /etc/systemd/system/nginx.service.d/keitaro-systemd-nginx.conf
    mode: '0644'
  register: nginx_changing_systemd_config_result

- name: Reload systemd
  systemd:
    daemon-reload: true
  when: nginx_changing_systemd_config_result.changed
