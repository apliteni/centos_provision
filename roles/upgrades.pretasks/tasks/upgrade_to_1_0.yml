- name: Backup nginx configs
  copy:
    src: /etc/nginx/conf.d/
    dest: "/etc/nginx/conf.d.{{ ansible_date_time.iso8601_basic_short }}"

- name: Stat vhosts.conf
  stat: path=/etc/nginx/conf.d/vhosts.conf
  register: vhosts_conf

- name: Rename vhosts.conf to keitaro.conf
  command: mv /etc/nginx/conf.d/vhosts.conf /etc/nginx/conf.d/keitaro.conf
  when: vhosts_conf.stat.exists

- name: Make ssl certs dir
  file:
    path: "{{ ssl_root }}"
    state: directory

- name: Copy ssl cert to the new location
  shell: "cp /etc/nginx/ssl/cert.pem {{ ssl_cert_path }}"

- name: Copy ssl private key to the new location
  command: "cp /etc/nginx/ssl/privkey.pem {{ ssl_privkey_path }}"

- name: Copy dhparam cert to the new location
  command: "cp /etc/ssl/certs/dhparam.pem {{ ssl_dhparam_path }}"