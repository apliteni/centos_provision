- name: Generate roadrunner related systemd units except roadrunner-watcher.path
  template:
    src: "systemd/{{ item }}.j2"
    dest: "/etc/systemd/system/{{ item }}"
  with_items: "{{ roadrunner_services | difference(['roadrunner-watcher.path']) }}"
  register: roadrunner_systemd_units

- name: Regenerate SystemD .path unit
  include: tune-systemd-regenerate-path-unit.yml

- name: Do daemon-reload to update SystemD services
  systemd:
    daemon-reload: true
  when: roadrunner_systemd_units.changed

- name: Enable roadrunner and related services if engine is roadrunner
  systemd:
    name: "{{ item }}"
    state: restarted
    enabled: yes
  with_items: "{{ roadrunner_services }}"
  when: "php_engine == 'roadrunner'"

- name: Disable roadrunner and related services if engine is not roadrunner
  systemd:
    name: "{{ item }}"
    state: stopped
    enabled: no
  with_items: "{{ roadrunner_services }}"
  when: "php_engine != 'roadrunner'"

