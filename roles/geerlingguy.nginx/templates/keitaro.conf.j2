# Generated by Keitaro install tool v{{ installer_version }}

server {
  server_name _;

  listen 80 default_server;

  listen 443 ssl;
  ssl_certificate {{ ssl_cert_path }};
  ssl_certificate_key {{ ssl_privkey_path }};
  ssl_session_cache   shared:SSL:10m;
  ssl_session_timeout 10m;
  ssl_prefer_server_ciphers on;
  ssl_dhparam {{ ssl_dhparam_path }};
  add_header X-Content-Type-Options nosniff;

  root {{ keitaro_root }};

  access_log  /var/log/nginx/keitaro.access.log main buffer=16k flush=15s;

  index index.php index.html;

  location ~* \.(jpg|jpeg|gif|png|js|css|txt|zip|ico|gz|csv)$ {
    expires 10d;
  }

  location ~ /\.(?!well-known).* {
    access_log off;
    log_not_found off;
    return 404;
  }

  location ~* /(var|lib|application)/.*$ {
    access_log off;
    log_not_found off;
    return 404;
  }

  location /status {
    include {{ nginx_conf_path }}/keitaro.php-fpm.inc;
    access_log off;
    allow 127.0.0.1;
    deny all;
  }

  location @keitaro-admin {
    include {{ nginx_conf_path }}/keitaro.php-fpm.inc;
  }

  location /admin {
    access_log off;
    access_log  /var/log/nginx/keitaro-admin.access.log main buffer=16k flush=15s;
    try_files $uri $uri/ @keitaro-admin;
  }

  include {{ nginx_conf_path }}/keitaro.root_location.inc;
}
