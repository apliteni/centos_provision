- name: Check if swap file exists
  stat:
    path: "{{ swap_file_path }}"
  register: swap_file_check

- name: Try to disable and remove current swap
  include: disable_and_remove_current_swap.yml
  when: swap_file_check.stat.exists

- name: Create and enable new swap
  include: create_and_enable_new_swap.yml
  when: >
    ( 
      swap_file_check.stat.exists 
          and swap_removed.path.state is defined
          and swap_removed.path.state == 'absent')
    or (
      not swap_file_check.stat.exists)
