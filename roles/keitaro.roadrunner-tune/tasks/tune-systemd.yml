- name: Generate roadrunner related systemd units
  template:
    src: "systemd/{{ item }}.j2"
    dest: "/etc/systemd/system/{{ item }}"
  with_items: "{{ roadrunner_services }}"

- name: Regenerate SystemD .path unit
  include: tune-systemd-regenerate-path-unit.yml

- name: Enable roadrunner and related services if engine is roadrunner
  systemd:
    name: "{{ item }}"
    daemon-reload: true
    state: restarted
    enabled: yes
  with_items: "{{ roadrunner_services }}"
  when: "php_engine == 'roadrunner'"

- name: Disable roadrunner and related services if engine is not roadrunner
  systemd:
    name: "{{ item }}"
    state: stopped
    enabled: no
  with_items: "{{ roadrunner_services }}"
  when: "php_engine != 'roadrunner'"

