- name: "Create tempfile for {{ package }}:{{ version }}"
  command: mktemp
  register: temp_file

- name: "Generate Dockerfile for {{ package }}:{{ version }}"
  template: src=Dockerfile.{{ package }}.j2 dest={{ temp_file.stdout }}

- name: "Build docker image for {{ package }}:{{ version }}"
  shell: "docker build -t keitarotds/{{ package }}:{{ version }} - < {{ temp_file.stdout }}"

- name: "Push docker image {{ package }}:{{ version }} to docker hub"
  command: "docker push keitarotds/{{ package }}:{{version}}"
