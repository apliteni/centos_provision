# we say server is High Performant, if it has more than 32G RAM
hp_memory_level_mb: 32768

# min 40% RAM, max 8G
db_memory_mb: "{{ ([ansible_memtotal_mb, hp_memory_level_mb] | min) * 0.4 }}"
db_memory_1pct_kb: "{{ (db_memory_mb|int) * 1024 / 100 | int }}"
db_connections: "{{ [(((db_memory_mb|int) / 512) | int), 6] | max }}"

# min 5% RAM, max 1G
redis_memory_mb: "{{ ([ansible_memtotal_mb, hp_memory_level_mb] | min) * 0.05 | int }}"

# min 45% RAM, max RAM - 20G
php_memory_mb: "{{ [ansible_memtotal_mb * 0.45, ansible_memtotal_mb - hp_memory_level_mb * 0.5] | max | int }}"
php_thread_size_mb: 35
php_threads_count: "{{ ((php_memory_mb|float) / php_thread_size_mb) | int }}"

ulimit_nofile: "{{ [(php_threads_count|int)*20, 1024] | max }}"
