- name: Ensure the log directory exists
  file:
    path: /var/log/mysql
    state: directory
    mode: '0755'

- name: Generate main mariadb config files
  template:
    src: "my.cnf.d/my.cnf.j2"
    dest: "/etc/my.cnf"
    mode: '0644'
  notify: restart mariadb

- name: Generate config files
  template:
    src: "my.cnf.d/{{ item }}.j2"
    dest: "/etc/my.cnf.d/{{ item }}"
    mode: '0644'
  with_items:
    - keitaro-mysqld-optimize_performance.cnf
    - keitaro-mysqld-set_default_storage_engine.cnf
    - keitaro-mysqld-configure_error_log.cnf
    - keitaro-mysqld-configure_network.cnf
  notify: restart mariadb

- name: Generate config files
  template:
    src: "my.cnf.d/{{ item }}.j2"
    dest: "/etc/my.cnf.d/{{ item }}"
    mode: '0644'
  with_items:
    - keitaro-mysqldump-disable_column_statistics.cnf
  when: centos_release_version != "7"

- name: Restart MariaDB
  meta: flush_handlers
