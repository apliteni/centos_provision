- name: Configure tracker
  when: installed_tracker_version is not defined
        or installed_tracker_version is version(kctl_tracker_version_to_install, '<')
        or 'tune' in kctl_tags
        or 'setup-tracker' in kctl_tags
  block:
    - include_tasks: 01-generate-env-file.yml

    - include_tasks: 02-generate-config.yml

    - include_tasks: 03-set-olap-db.yml

    - include_tasks: 04-setup-clickhouse.yml
      when: olap_db == 'clickhouse'

    - include_tasks: 05-migrate-clickhouse.yml
      when: olap_db == 'clickhouse'

    - include_tasks: 06-migrate-mariadb.yml

    - include_tasks: 07-setup-clickhouse-foreign-tables.yml
      when: olap_db == 'clickhouse'

    - include_tasks: 08-set-tracker-stability.yml
      when: update_channel != ''

    - include_tasks: 09-update-geodb.yml

    - include_tasks: 10-configure-cron.yml

    - include_tasks: 11-generate-watchlist.yml
