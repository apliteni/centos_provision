- name: Check if keitaro schema exists
  community.mysql.mysql_query:
    login_db: "{{ db_name }}"
    query: SELECT table_name FROM information_schema.tables WHERE table_schema = 'keitaro' AND table_name = 'keitaro_users';
  register: db_schema_exists_query

- name: Define db_schema_is_empty helper variable
  set_fact:
    db_schema_is_empty: "{{ db_schema_exists_query.query_result == [[]] }}"

- name: Generate DB schema
  when: db_schema_is_empty
  community.mysql.mysql_db:
    state: import
    name: "{{ db_name }}"
    target: "{{ item }}"
  with_items:
    - "{{ keitaro_database_schema }}"
    - "{{ keitaro_database_data }}"
